<script src="http://d3js.org/d3.v3.js"></script>
<body>
<script type="application/javascript">
var dataset =  [ [ { sno: '0177',
                        sna: '葫蘆國小',
                        tot: '40',
                        sbi: '15',
                        sarea: '士林區',
                        mday: '2016022720'
                        } ],

                    [ { sno: '0177',
                        sna: '葫蘆國小',
                        tot: '40',
                        sbi: '35',
                        sarea: '士林區',
                        mday: '2016022721'
                    } ],

                    [ { sno: '0177',
                        sna: '葫蘆國小',
                        tot: '40',
                        sbi: '11',
                        sarea: '士林區',
                        mday: '2016022722'
                    } ]
                    ];


var margin = {top: 20, right: 80, bottom: 30, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
// var x = d3.time.scale()
//     .range([0, width]);

// ex: 2016 0227 21
var parseDate = d3.time.format("%Y%m%d%I").parse;

var x = d3.time.scale()
    .range([0, width]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var mdaymap = d3.map(dataset, function(it) { return it[0]["mday"]; }).keys();
console.log("mdaymap:"+mdaymap);


var y = d3.scale.linear()
    .range([height, 0]);


var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");


var line = d3.svg.line()
    .x(function(d) { console.log("line:"+parseDate(d[0]["mday"]));return parseDate(d[0]["mday"]); })
    .y(function(d) { console.log("sbi:" + d[0].sbi);return d[0]["sbi"]; });

var svgContainer = d3.select("body").append("svg")
                                    .attr("width", width + margin.left + margin.right)
                                    .attr("height", height + margin.top + margin.bottom);


x.domain(d3.extent(dataset, function(d) {console.log("domain:"+parseDate(d[0]["mday"]));return parseDate(d[0]["mday"]); }));

svgContainer.append("text")
        .attr("x", (width / 2))             
        .attr("y", margin.top)
        .attr("text-anchor", "middle")  
        .style("font-size", "16px") 
        .text("可借車位");

var scoregroup = d3.nest().key(function(it) {
   return it[0]["mday"];
 }).entries(dataset);


var youbikestation = svgContainer.selectAll(".station")
              .data(scoregroup)
              .enter().append("g")
              .attr("class", "station");
 

youbikestation.append("path")
    .attr("class", "line")
    .attr("d", function(d) { return line(d.values); })
    .style("stroke", "#FF0000");

svgContainer.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);



</script>
</body>